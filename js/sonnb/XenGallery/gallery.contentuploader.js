
/**
 * @category    XenForo
 * @package     sonnb - XenGallery
 * @version     2.1.3
 * @copyright:  sonnb
 * @link        www.sonnb.com
 * @version     One license is valid for only one nominated domain.
 * @license     You might not copy or redistribute this addon. Any action to public or redistribute must be authorized from author
 */
!function(e,t,n,r){XenForo.XenGalleryContentEditor=function(t){this.setVisibility=function(e){var n=t.closest(".ctrlUnit"),r=t.find(".AttachedContent:not(#AttachedContentTemplate)");if(n.length==0){n=t}if(e===true){if(r.length){n.show()}else{n.hide()}}else{if(r.length){n.xfFadeDown(XenForo.speed.normal)}else{n.xfFadeUp(XenForo.speed.normal,false,false,"swing")}}};this.setVisibility(true);var n=e.context(this,"setVisibility");e("#PhotoUploader").bind("AttachmentsChanged",n);e("#VideoUploader").bind("AttachmentsChanged",n)};XenForo.XenGalleryContentUploader=function(t){var n=XenForo.AttachmentUploader(t),r=XenForo.speed.normal,i=XenForo.speed.fast;var s=function(n){var r="";if(n.ajaxData){e.each(n.ajaxData.error,function(e,t){r+=t+"\n"})}else{r+=n.message+"\n"}XenForo.alert(r+"<br /><br />"+n.file.name);e("#"+n.file.id).xfRemove("xfFadeUp",function(){if(e(".ContentEditor .AttachedContent").length<2){e("#noContent").fadeIn()}},i);t.closest("form").find('input[type="submit"]').removeClass("disabled").removeAttr("disabled");console.warn("AttachmentUploadError: %o",n)};var o=function(e){var t;switch(e.file.name.substr(e.file.name.lastIndexOf(".")).toLowerCase()){case".flv":case".wmv":case".avi":case".mpeg":case".mkv":case".mov":case".mp4":case".3gp":{t=true;break};default:{t=false}}return t};t.bind({AttachmentQueueValidation:function(n){var r=e(".ContentEditor").find(".AttachedContent:visible");if(r.length>t.data("maxfileupload")){XenForo.alert(t.data("error-maxfileupload"));n.swfUpload.cancelUpload(n.file.id,false);e("#"+n.file.id).remove()}if(!o(n)&&!n.isImage){n.swfUpload.cancelUpload(n.file.id,false);console.log("Invalid File Type Selected: %s (%d bytes)",n.file.name,n.file.size);return}},AttachmentQueued:function(n){if(!o(n)&&!n.isImage){n.swfUpload.cancelUpload(n.file.id,false);console.log("Invalid File Type Selected: %s (%d bytes)",n.file.name,n.file.size);return}t.closest("form").find('input[type="submit"]').addClass("disabled").attr("disabled","disabled");console.log("Queued: %s (%d bytes)",n.file.name,n.file.size);var i=e("#AttachedContentTemplate").clone().attr("id",n.file.id);i.find(".progress .gauge .meter").css("width","0%");i.find(".controls").hide();i.xfInsert("appendTo",".ContentList.Existing",null,r);t.trigger("AttachmentsChanged");e(".ContentEditor").closest("dl").show();e("#noContent").fadeOut();e("#"+n.file.id).find(".progress").show()},AttachmentUploadProgress:function(t){var n=e("#"+t.file.id),r=n.find(".progress"),i=r.find(".meter"),s=r.find(".text"),o=Math.min(90,Math.ceil(t.bytes*100/t.file.size)),u=o+"%";s.text(u);i.css("width",u)},AttachmentQueueError:s,AttachmentUploadError:s,AttachmentUploaded:function(n){if(n.file){var i=e("#"+n.file.id),s=i.find(".progress"),o=s.find(".meter"),u=s.find(".text"),a=e("#"+n.file.id),f=a.find(".progress"),l=e(n.ajaxData.templateHtml),c;u.text("100%").hide();o.css("width","100%");f.fadeOut(XenForo.speed.fast,function(){l.find(".description").xfInsert("insertBefore",f,"fadeIn",XenForo.speed.fast);c=a.find(".Thumbnail");c.replaceWith(l.find(".Thumbnail"));XenForo.activate(c);var t=a.find(".controls");t.replaceWith(l.find(".controls")).show();XenForo.activate(t);f.xfRemove();a.attr("id","content"+n.ajaxData.content_data_id);var r=a.find("input.location");r.each(function(){var t=e(this);t.geocomplete().bind("geocode:result",function(e,n){if(n.geometry.location.kb){t.parents("li.AttachedContent").find("input.location_lat").val(n.geometry.location.kb)}if(n.geometry.location.lb){t.parents("li.AttachedContent").find("input.location_lng").val(n.geometry.location.lb)}return false;e.preventDefault()})});var i=a.find(".controls .peopleIcon"),s=a.find(".controls .placeIcon"),o=a.find(".controls .coverIcon"),u=a.find(".controls .delete");XenForo.XenGalleryContentPeople(i);XenForo.XenGalleryContentPlace(s);XenForo.XenGalleryContentCover(o);XenForo.XenGalleryContentDelete(u)})}else{var a=e("#content"+n.ajaxData.content_data_id);if(!a.length){a=e(n.ajaxData.templateHtml).xfInsert("appendTo",e(".ContentEditor").find(".ContentList.Existing"),null,r);var h=e(".ContentEditor").find("#content"+n.ajaxData.content_data_id).find("input.location");h.each(function(){var t=e(this);t.geocomplete().bind("geocode:result",function(e,n){e.preventDefault();if(n.geometry.location.kb){t.parents("li.AttachedContent").find("input.location_lat").val(n.geometry.location.kb)}if(n.geometry.location.lb){t.parents("li.AttachedContent").find("input.location_lng").val(n.geometry.location.lb)}return false})});var p=a.find(".controls .peopleIcon"),d=a.find(".controls .placeIcon"),v=a.find(".controls .coverIcon"),m=a.find(".controls .delete");XenForo.XenGalleryContentPeople(p);XenForo.XenGalleryContentPlace(d);XenForo.XenGalleryContentCover(v);XenForo.XenGalleryContentDelete(m);e(".ContentEditor").closest("dl").show();e("#noContent").fadeOut()}}t.closest("form").find('input[type="submit"]').removeClass("disabled").removeAttr("disabled");t.trigger("AttachmentsChanged")}})};XenForo.XenGalleryContentPeople=function(e){e.click(function(t){var n=e.parents(".AttachedContent"),r=n.find(".description input.people");if(r.is(":visible")){e.removeClass("active");r.hide()}else{e.addClass("active");r.show()}})};XenForo.XenGalleryContentPlace=function(e){e.click(function(t){var n=e.parents(".AttachedContent"),r=n.find(".description input.location");if(r.is(":visible")){e.removeClass("active");r.hide()}else{e.addClass("active");r.show()}})};XenForo.XenGalleryContentCover=function(t){t.click(function(n){var r=t.parents(".AttachedContent"),i=r.find("input.cover"),s=r.find("input.coverType"),o=e(".controls .coverIcon");if(t.hasClass("active")){t.removeClass("active");i.attr("checked",false);s.attr("checked",false)}else{o.removeClass("active");t.addClass("active");i.attr("checked",true);s.attr("checked",true)}})};XenForo.XenGalleryContentDelete=function(t){t.click(function(n){var r=t.closest(".AttachedContent"),i=t.data("content"),s=e("#delete_"+i);s.val(i);r.fadeOut()})};XenForo.XenGalleryEmbedVideo=function(t){var n=new XenForo.AutoValidator(t);t.bind("AutoValidationBeforeSubmit",function(t){var n=e(".ContentEditor").find(".AttachedContent:visible");if(n.length>e("#ctrl_video_embed").data("maxfileupload")){XenForo.alert(e("#ctrl_video_embed").data("error-maxfileupload"));t.preventSubmit=true}});t.bind("AutoValidationComplete",function(t){var n=e("#content"+t.ajaxData.content_data_id),r=e(".ContentUploader");if(!n.length){n=e(t.ajaxData.templateHtml).xfInsert("appendTo",e(".ContentEditor").find(".ContentList.Existing"),null,XenForo.speed.normal);var i=n.find("input.location");i.each(function(){var t=e(this);t.geocomplete().bind("geocode:result",function(e,n){e.preventDefault();if(n.geometry.location.kb){t.parents("li.AttachedContent").find("input.location_lat").val(n.geometry.location.kb)}if(n.geometry.location.lb){t.parents("li.AttachedContent").find("input.location_lng").val(n.geometry.location.lb)}return false})});e(".ContentEditor").closest("dl").show();e("#noContent").fadeOut();var s=n.find(".controls .peopleIcon"),o=n.find(".controls .placeIcon"),u=n.find(".controls .coverIcon"),a=n.find(".controls .delete");r.closest("form").find('input[type="submit"]').removeClass("disabled").removeAttr("disabled");XenForo.XenGalleryContentPeople(s);XenForo.XenGalleryContentPlace(o);XenForo.XenGalleryContentCover(u);XenForo.XenGalleryContentDelete(a);r.trigger("AttachmentsChanged")}})};if(typeof XenForo.AttachmentUploader=="function"){XenForo.register(".ContentUploader","XenForo.XenGalleryContentUploader");XenForo.register(".ContentEditor","XenForo.XenGalleryContentEditor");XenForo.register(".formEmbedVideo","XenForo.XenGalleryEmbedVideo")}XenForo.register(".AttachedContent .controls .peopleIcon","XenForo.XenGalleryContentPeople");XenForo.register(".AttachedContent .controls .placeIcon","XenForo.XenGalleryContentPlace");XenForo.register(".AttachedContent .controls .coverIcon","XenForo.XenGalleryContentCover");XenForo.register(".AttachedContent .controls .delete","XenForo.XenGalleryContentDelete")}(jQuery,this,document)