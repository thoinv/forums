/**
 * @author kier
 */
/** @param {jQuery} $ jQuery Object */
!function(e,t,n,r){XenForo.InlineModForm=function(e){this.__construct(e)};XenForo.InlineModForm.prototype={__construct:function(t){this.$form=t;this.$form.data("InlineModForm",this);this.$checkAll=this.$form.find("#ModerationCheck").click(e.context(this,"checkAll"));var r=e(this.$form.data("controls")),i=r.closest(".InlineMod"),s=this.$form.data("overlayid"),o=e(".SelectionCountContainer");if(!s){s="InlineModOverlay"}r.show().appendTo("body").wrap('<form class="InlineModOverlay" id="'+s+'" />');if(o.length){r.find(".SelectionCount").clone(true).appendTo(o).attr("href","#").addClass("cloned")}this.$totals=e(".InlineModCheckedTotal");if(i.hasClass("Hide")){i.remove()}this.overlay=null;this.cookieName=false;this.selectedIds=[];this.lastCheck=null;this.overlay=null;if(t.data("cookiename")){this.cookieName="inlinemod_"+t.data("cookiename");this.updateSelectedIdsFromCookie()}e(n).one("XenForoActivationComplete",e.context(this,"setState"))},updateSelectedIdsFromCookie:function(){if(!this.cookieName){return[]}var t=this.selectedIds;this.cookieValue=e.getCookie(this.cookieName);if(this.cookieValue){this.selectedIds=this.cookieValue.split(",")}else{this.selectedIds=[]}return{original:t,selected:this.selectedIds,isDifferent:t!==this.selectedIds}},setState:function(){var e=this.selectedIds.length;this.$totals.closest(".cloned")[e?"addClass":"removeClass"]("itemsChecked");this.$totals.text(e)},recalculateSelected:function(){var t=this.selectedIds;this.$form.find("input:checkbox.InlineModCheck").each(function(){var n=e(this),r=n.data("XenForo.InlineModItem"),i=n.attr("checked");if(!r){return}if(t&&e.inArray(n.val(),t)>=0){if(!i){n.attr("checked",true);r.setStyle()}}else if(i){n.attr("checked",false);r.setStyle()}})},setSelectedIdState:function(t,n){var r=this.updateSelectedIdsFromCookie();if(r.isDifferent){setTimeout(e.context(this,"recalculateSelected"),0)}var i=e.inArray(t,this.selectedIds);if(n){if(i>=0){return}this.selectedIds.push(t);this.selectedIds.sort(function(e,t){return e-t})}else{if(i<0){return}this.selectedIds.splice(i,1)}this.setState();if(!this.cookieName){return}if(!this.selectedIds.length){e.deleteCookie(this.cookieName)}else{e.setCookie(this.cookieName,this.selectedIds.join(","))}},checkAll:function(e){this.$form.find("input:checkbox.InlineModCheck").attr("checked",e.target.checked).trigger("change");if(!e.target.checked){this.overlay.close()}e.stopImmediatePropagation()},clickNextPrev:function(t){var n=this.$form.find("input:checkbox.InlineModCheck"),r=this.lastCheck,i=null;n.each(function(n,s){if(s==r){i=e(t.target).hasClass("ClickPrev")?n-1:n+1;return false}});if(i===null||i>=n.length){i=0}n.eq(i).get(0).focus();var s=e(this.lastCheck);if(s.length){e(XenForo.getPageScrollTagName()).animate({scrollTop:n.eq(i).offset().top-e(this.lastCheck).offset().top+e(XenForo.getPageScrollTagName()).scrollTop()},XenForo.speed.normal)}this.positionOverlay(n.eq(i).get(0))},createOverlay:function(){var t=this.$form.data("overlayid"),n=this.$form.data("imodoptions");if(!t){t="InlineModOverlay"}var r=e("#"+t),i=r.find(n);r.children().show();r.overlay({closeOnClick:false,fixed:false,close:".OverlayCloser"});i.change(e.context(this,"chooseAction"));r.find("input:submit").click(e.context(this,"chooseAction"));r.find(".ClickNext, .ClickPrev").click(e.context(this,"clickNextPrev"));return this.overlay=r.data("overlay")},positionOverlay:function(t){if(t.checked||this.$form.find("input:checkbox:checked.InlineModCheck").length){console.info("Position overlay next to %o",t);if(!this.overlay){this.createOverlay()}var n=this.overlay,r=e(t).offset(),i=r.left,s=r.top-15;if(XenForo.isRTL()){i-=n.getOverlay().outerWidth()+5}else{i+=17}if(!n.isOpened()){n.getConf().left=i-e(XenForo.getPageScrollTagName()).scrollLeft();n.getConf().top=s-e(XenForo.getPageScrollTagName()).scrollTop();n.load()}else{n.getOverlay().animate({left:i,top:s},this.lastCheck&&!XenForo.isTouchBrowser()?XenForo.speed.normal:0,"easeOutBack")}}else if(this.overlay&&this.overlay.isOpened()){this.overlay.close()}this.lastCheck=t},nonCheckboxShowOverlay:function(t){t.preventDefault();if(!this.overlay){this.createOverlay()}this.overlay.load();var n=e(t.target).coords(),r=this.overlay.getOverlay().coords(),i;if(XenForo.isRTL()){i=n.left}else{i=n.left+n.width-r.width}this.overlay.getOverlay().css({left:i,top:n.top+n.height+5});delete this.lastCheck},chooseAction:function(t){t.preventDefault();var n,r,i=e(t.target),s=this.$form.data("imodoptions");if(i.is(":submit")&&i.attr("name")){n=i.attr("name")}else{n=e(s).val()}if(n==""){this.overlay.close();return false}if(this.running){return false}r=n+"PreAction";if(typeof this[r]=="function"){this[r](t)}else{this.execAction(n)}},resetActionMenu:function(){this.overlay.getOverlay().get(0).reset()},execAction:function(t){this.running=true;XenForo.ajax(this.$form.attr("action"),this.$form.serialize()+"&a="+t,e.context(function(e,n){this.running=false;this.resetActionMenu();if(XenForo.hasResponseError(e)){return false}if(XenForo.hasTemplateHtml(e)){var r,i={};i.title=e.title||e.h1;i.noCache=true;new XenForo.ExtLoader(e,function(){console.info("show overlay");XenForo.createOverlay("",e.templateHtml,i).load()})}else if(e._redirectTarget){console.log("Inline moderation, %s complete.",t);var s=t+"PostAction";if(typeof this[s]=="function"){this[s](e,n)}else{XenForo.redirect(e._redirectTarget)}}},this));var n=t+"MidAction";if(typeof this[n]=="function"){this[n](t)}},closeOverlayPreAction:function(e){this.resetActionMenu();this.overlay.close()},deselectPreAction:function(t){this.$form.find("input:checkbox.InlineModCheck:checked").attr("checked",false).trigger("change");this.selectedIds=[];this.setState();if(this.cookieName){e.deleteCookie(this.cookieName)}this.$checkAll.attr("checked",false);this.resetActionMenu();this.overlay.close()}};XenForo.InlineModItem=function(e){this.__construct(e)};XenForo.InlineModItem.prototype={__construct:function(t){this.$form=t.closest("form");this.$ctrl=t.attr("title",XenForo.htmlspecialchars(t.attr("title")));if(XenForo.isTouchBrowser()){}else{this.$ctrl.tooltip(XenForo.configureTooltipRtl({effect:"fade",fadeInSpeed:XenForo.speed.xfast,offset:[-10,-20],predelay:e.browser.msie?0:100,position:"top right",tipClass:"xenTooltip inlineModCheckTip",onBeforeShow:e.context(this,"beforeTooltip")}))}this.arrowAppended=false;this.$target=e(t.data("target"));if(this.$form.data("InlineModForm")){var n=this.$form.data("InlineModForm");if(n.selectedIds.length){if(e.inArray(t.val(),n.selectedIds)>=0){t.attr("checked","checked")}}}this.$ctrl.bind({change:e.context(this,"setState"),click:e.context(this,"positionOverlay")});this.setStyle()},setState:function(e){this.setStyle();var t=this.$form.data("InlineModForm");if(t){t.setSelectedIdState(this.$ctrl.val(),this.$ctrl.attr("checked"))}},setStyle:function(){if(this.$ctrl.is(":checked")){this.$target.addClass("InlineModChecked")}else{this.$target.removeClass("InlineModChecked")}},positionOverlay:function(e){if(this.$ctrl.data("target")){var t,n=this.$form.data("InlineModForm");if(n){if(t=this.$ctrl.data("tooltip")){this.$ctrl.data("tooltip").hide()}n.positionOverlay(e.target)}}},beforeTooltip:function(e){if(e.target.checked||this.$form.find("input:checkbox:checked.InlineModCheck").length){return false}if(!this.arrowAppended){this.$ctrl.data("tooltip").getTip().append('<span class="arrow" />');this.arrowAppended=true}}};XenForo.register("form.InlineModForm","XenForo.InlineModForm");XenForo.register("input:checkbox.InlineModCheck","XenForo.InlineModItem")}(jQuery,this,document)