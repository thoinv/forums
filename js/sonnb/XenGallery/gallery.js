
/**
 * @category    XenForo
 * @package     sonnb - XenGallery
 * @version     2.1.3
 * @copyright:  sonnb
 * @link        www.sonnb.com
 * @version     One license is valid for only one nominated domain.
 * @license     You might not copy or redistribute this addon. Any action to public or redistribute must be authorized from author
 */
!function(e,t,n,r){XenForo.XenGalleryQuickEdit=function(r){var i=e("#"+r.data("quickform")),s=r.data("reset"),o=i.closest(".galleryOverlay"),u=i.find("input.closer");r.click(function(a){a.preventDefault();if(i.length){e(".quickEditForm").hide();i.find("dl.ctrlUnit").addClass("surplusLabel");var f=e(t);if(o.length){i.fadeIn().css({top:Math.max(0,(f.height()-i.outerHeight())/2),left:Math.max(0,(f.width()-i.outerWidth())/2)})}else{i.fadeIn().css({top:Math.max(0,(f.height()-i.outerHeight())/2+f.scrollTop()),left:Math.max(0,(f.width()-i.outerWidth())/2+f.scrollLeft())})}e(n).bind("click",function(t){var n=t.target;if(!r.has(n).length&&!i.has(n).length&&n!=r[0]&&n!=i[0]){e(this).unbind(t);i.hide()}});u.bind("click",function(e){u.unbind(e);i.hide()});if(i.data("AutoValidator")!=true){var l=new XenForo.AutoValidator(i);i.data("AutoValidator",true);i.bind("AutoValidationComplete",function(e){if(e.textStatus=="success"){i.hide();if(s){i.find("input").val()}if(e.ajaxData._redirectMessage){XenForo.alert(e.ajaxData._redirectMessage,"",3e3);return false}else if(e.ajaxData.message){XenForo.alert(e.ajaxData.message,"",3e3);return false}}})}}})};XenForo.XenGalleryLikeAlbum=function(t){t.click(function(t){t.preventDefault();var n=e(this);XenForo.ajax(this.href,{},function(t,r){if(XenForo.hasResponseError(t)){return false}n.stop(true,true);if(t.liked){n.addClass("active")}else{n.removeClass("active")}var i=e(n.data("container"));if(t.content&&typeof t.content.likes!=null){i.text(t.content.likes)}})})};XenForo.WatchLink=function(t){t.click(function(t){t.preventDefault();var n=e(this);XenForo.ajax(this.href,{},function(t,r){if(XenForo.hasResponseError(t)){return false}n.stop(true,true);if(t.term){n.find(".WatchLabel").html(t.term);if(t.cssClasses){e.each(t.cssClasses,function(e,t){n[t=="+"?"addClass":"removeClass"](e)})}}})})};XenForo.XenGalleryPhotoWrapper=function(e){this.__construct(e)};XenForo.XenGalleryPhotoWrapper.prototype={__construct:function(t){this.container=t;this.prev=e(".pwPhoto .prevPhoto",t);this.next=e(".pwPhoto .nextPhoto",t);this.comment=e(".pwPhotoActions .action.comment",t);this.like=e(".pwPhotoActions .action.like",t);this.share=e(".pwPhotoActions .action.share",t);var r=e(".photo.lazy",t);this.photoLazy=r;this.photoLazy.bind("load",function(){r.removeClass("lazy").addClass("loaded").data("src","").closest(".pwPhoto").addClass("loaded")}).bind("error",function(){r.parent().addClass("broken")}).attr("src",r.data("src"));this.comment.click(e.context(this,"actionComment"));this.like.click(e.context(this,"actionLike"));this.share.click(e.context(this,"actionShare"));e(n).keyup(e.context(this,"keyPress"))},keyPress:function(n){if(!e(".photoTag-tag").is(":visible")&&!e("body > div.xenOverlay").is(":visible")){var r=n.keyCode||n.charCode;switch(r){case 37:n.preventDefault();if(this.prev.hasClass(".hasPhoto")){t.location=XenForo.canonicalizeUrl(this.prev.attr("href"))}break;case 39:n.preventDefault();if(this.prev.hasClass(".hasPhoto")){t.location=XenForo.canonicalizeUrl(this.next.attr("href"))}break;default:return}}},actionComment:function(t){t.preventDefault();var n=e("a.XenGalleryCommentPoster"),r=e(n.data("commentarea"));r.xfFadeDown(XenForo.speed.fast,function(){e(this).find('textarea[name="message"]').focus()})},actionLike:function(t){t.preventDefault();var n=this.like;var r=e("a.LikeLink");XenForo.ajax(n.attr("href"),{},function(t,i){if(XenForo.hasResponseError(t)){return false}n.stop(true,true);if(t.term){r.find(".LikeLabel").html(t.term);if(t.cssClasses){e.each(t.cssClasses,function(e,t){if(t=="+"&&e=="like"){n.removeClass("active");return}if(t=="+"&&e=="unlike"){n.addClass("active");return}r[t=="+"?"addClass":"removeClass"](e)})}}if(t.templateHtml===""){e(r.data("container")).xfFadeUp(XenForo.speed.fast,function(){e(this).empty().xfFadeDown(0)})}else{var s=e(r.data("container")),o=s.find(".LikeText"),u=e(t.templateHtml);if(o.length){o.xfFadeOut(50,function(){var t=this.parentNode;e(this).remove();u.find(".LikeText").xfInsert("appendTo",t,"xfFadeIn",50)})}else{new XenForo.ExtLoader(t,function(){u.xfInsert("appendTo",s)})}}})},actionShare:function(t){t.preventDefault();var n=this.share,r={fixed:false,className:"shareOverlay",onBeforeLoad:function(){n.addClass("active")},onClose:function(){n.removeClass("active")}};r=e.extend(r,this.share.data("overlayoptions"));XenForo.createOverlay(null,e(".shareContainer"),r).load()}};XenForo.XenGalleryPhotoShare=function(e){this.__construct(e)};XenForo.XenGalleryPhotoShare.prototype={__construct:function(t){this.element=t;t.click(e.context(this,"actionClick"))},actionClick:function(n){n.preventDefault();var r=e(n.target).parent(),i=encodeURIComponent(XenForo.canonicalizeUrl(r.data("url"))),s=encodeURIComponent(XenForo.canonicalizeUrl(r.data("thumbnail")));if(r.hasClass("google")){t.open("http://plus.google.com/share?url="+i,"google","toolbar=0,status=0,width=580,height=325")}else if(r.hasClass("facebook")){t.open("http://www.facebook.com/sharer/sharer.php?u="+i,"facebook","toolbar=0,status=0,width=580,height=325")}else if(r.hasClass("twitter")){t.open("https://twitter.com/intent/tweet?url="+i+"&ptext=","twitter","toolbar=0,status=0,width=580,height=325")}else if(r.hasClass("tumblr")){t.open("//www.tumblr.com/share/photo?click_thru="+i+"&caption=&source="+s,"tumblr","toolbar=0,status=0,width=580,height=325")}else if(r.hasClass("pinterest")){t.open("http://pinterest.com/pin/create/button/?url="+i+"&media="+s,"pinterest","toolbar=0,status=0,width=580,height=325")}}};XenForo.XenGalleryListLazyLoad=function(t){t.each(function(){var t=e(this);t.bind("load",function(){t.removeClass("lazy").addClass("loaded").data("src","").parent().css({width:"auto"}).closest(".img").addClass("loaded");var e=t.height();if(e<110){t.css({top:(110-e)/2})}}).bind("error",function(){t.parent().parent().addClass("broken")}).attr("src",t.data("src"))})};XenForo.XenGalleryContainer=function(e){this.__construct(e)};XenForo.XenGalleryContainer.prototype={__construct:function(n){this.$container=n;this.width=0;this.isNoResize=e(n).data("noresize");this.checkWindowSize(null,false);if(n.data("nomasonry")){return true}if(n.data("imagesloaded")){n.imagesLoaded(function(){n.masonry({itemSelector:".itemGallery",isAnimated:!Modernizr.csstransitions,easing:"linear",gutterWidth:10})})}else{n.masonry({itemSelector:".itemGallery",isAnimated:!Modernizr.csstransitions,easing:"linear",gutterWidth:10})}e(t).bind("orientationchange resize",e.context(this,"windowResize"));if(!n.data("noautoscroll")){var r=this;n.infinitescroll({navSelector:".xengallery .PageNav nav > a.currentPage",nextSelector:".xengallery .PageNav nav > a:last-child",itemSelector:".itemGallery",extraScrollPx:50,bufferPx:1e3,localMode:true,loading:{msgText:n.data("loading"),finishedMsg:n.data("finish"),img:n.data("ajax")},dataType:"html",maxPage:e(".xengallery .PageNav").data("last")},function(t){var i=e(t).css({opacity:0});if(n.data("imagesloaded")){i.imagesLoaded(function(){i.animate({opacity:1});i.addClass("__XenForoActivator").xfActivate();n.masonry("appended",i,true,function(){r.checkWindowSize(null,true);n.masonry()})})}else{i.animate({opacity:1});i.addClass("__XenForoActivator").xfActivate();n.masonry("appended",i,true,function(){r.checkWindowSize(null,true);n.masonry()})}})}},windowResize:function(e){if(!this.isNoResize){this.checkWindowSize(null,false)}this.$container.masonry()},checkWindowSize:function(n,r){if(n===null){n=e(t).width()}if(this.isNoResize){return false}if(this.width===n&&r===false){return true}this.width=n;var i=e(".itemGallery",this.$container),s=this.$container.outerWidth(),o=parseInt(i.css("margin-right")),u=0;if(o<1){o=10}if(this.width<=320&&s<=320){u=Math.floor(s);i.width(u)}else if(this.width<=500&&s<=500){u=Math.floor((s-o)/2);i.width(u)}else{var a=Math.floor(s/200);u=Math.floor((s-(a-1)*o)/a);i.width(u).css({"min-width":"0","max-width":"none"}).find("img").css("max-width","100%")}if(u>0){i.each(function(t){var n=e("div.img",e(this)),r=e("a",n),i=n.data("width"),s=n.data("height"),o=Math.floor(s*(u/i));if(i>u){o=Math.floor(s*(u/i))}else{o=Math.floor(s)}if(o<110){o=110}r.css({height:o,"max-height":o})})}}};XenForo.XenGalleryStreamEditor=function(e){this.__construct(e)};XenForo.XenGalleryStreamEditor.prototype={__construct:function(t){this.container=t;this.streamList=e(".streamList ul",t);this.form=e("form.xenForm",t);this.input=e('input[name="stream_name"]',this.form);e(".streamItem a.delete").bind("click",e.context(this,"onDelete"));this.form.bind("submit",e.context(this,"onFormSubmit"));this.form.find('input[type="submit"]').click(e.context(this,"onSubmitClick"))},onFormSubmit:function(t){t.preventDefault();var n=this.form.data("clickedsubmitbutton"),r,i;if(!this.input.val()){return true}this.form.removeData("clickedsubmitbutton");r=this.form.serializeArray();if(n){i=e(n);if(i.attr("name")){r.push({name:i.attr("name"),value:i.attr("value")})}}XenForo.ajax(this.form.attr("action"),r,e.context(this,"onDataReceived"))},onSubmitClick:function(e){this.form.data("clickedsubmitbutton",e.target)},onDataReceived:function(t,n){var r=this.streamList,i=this.input;if(!t){console.warn("No ajax data returned.");return false}if(XenForo.hasResponseError(t)){return false}if(t.streams){e.each(t.streams,function(t,n){e(n).xfInsert("appendTo",r,"xfFadeIn",0)});i.val("")}else{console.warn("No valid ajax data returned.")}return false},onDelete:function(t){t.preventDefault();var n=e(t.target);XenForo.ajax(n.attr("href"),{},function(e,t){if(XenForo.hasResponseError(e)){return false}if(XenForo.hasTemplateHtml(e)||e.message||e.stream){n.closest("li").fadeOut().remove()}})}};XenForo.XenGalleryStreamEditorToggle=function(t){var n=e(".streamingEditor .xenForm");t.click(function(t){t.preventDefault();n.show();e(this).fadeOut()})};XenForo.XenGalleryStreamJump=function(n){n.submit(function(r){r.preventDefault();if(!e('input[name="stream_name"]',n).val()){return false}XenForo.ajax(n.attr("action"),n.serializeArray(),function(e,n){if(XenForo.hasResponseError(e)){return false}if(!e.valid){XenForo.alert(e.errorPhrase,XenForo.phrases.following_error_occurred+":")}else{url=XenForo.canonicalizeUrl(e.link);if(url==t.location.href){t.location.reload()}else{t.location=url}}})})};XenForo.XenGalleryCommentLoader=function(e){this.__construct(e)};XenForo.XenGalleryCommentLoader.prototype={__construct:function(t){this.$link=t;t.click(e.context(this,"click"))},click:function(t){var n=this.$link.data("loadparams");if(typeof n!="object"){n={}}t.preventDefault();XenForo.ajax(this.$link.attr("href"),n,e.context(this,"loadSuccess"),{type:"GET"})},loadSuccess:function(t){var n,r=this.$link.data("replace"),i;if(r){n=e(r)}else{n=this.$link.parent()}if(XenForo.hasResponseError(t)){n.xfRemove();return false}if(t.comments&&t.comments.length){for(i=0;i<t.comments.length;i++){e(t.comments[i]).xfInsert("insertBefore",n)}}n.xfRemove()}};XenForo.XenGalleryCommentPoster=function(e){this.__construct(e)};XenForo.XenGalleryCommentPoster.prototype={__construct:function(t){this.$link=t;this.$parent=t.closest(".commentWrapper");this.$allCommentArea=this.$commentArea;var n=t.data("commentarea");this.$commentArea=e(n,this.$parent);if(n.indexOf("#")>=0){n=n.replace("#","");this.$allCommentArea=e('[id="'+n+'"]')}if(this.$commentArea.data("submiturl")){this.submitUrl=this.$commentArea.data("submiturl")}else{this.submitUrl=t.attr("href")}t.click(e.context(this,"click"));this.$commentArea.find("input:submit, button").click(e.context(this,"submit"))},click:function(t){t.preventDefault();this.$commentArea.xfFadeDown(XenForo.speed.fast,function(){e(this).find('textarea[name="message"]').focus()})},submit:function(t){t.preventDefault();var n=this.$link.data("postparams"),r=this.$commentArea.closest("form:not(.InlineModForm)");if(typeof n!="object"){n={}}n.message=this.$commentArea.find('textarea[name="message"]').val();if(r.length){if(!r.data("multisubmitdisable")){XenForo.MultiSubmitFix(r)}r.data("multisubmitdisable")()}XenForo.ajax(this.submitUrl,n,e.context(this,"submitSuccess"))},submitSuccess:function(t){var n=this.$commentArea.closest("form"),r;if(n.data("multisubmitenable")){n.data("multisubmitenable")()}if(XenForo.hasResponseError(t)){return false}if(t.comments&&t.comments.length){for(r=0;r<t.comments.length;r++){e(t.comments[r]).xfInsert("insertBefore",this.$allCommentArea,"slideDown",XenForo.speed.normal)}}e("a.XenGalleryCommentPoster").data("postparams",{after:t.lastShownCommentDate});this.$commentArea.find('textarea[name="message"]').val("")}};XenForo.XenGalleryCommentInlineEdit=function(e){this.__construct(e)};XenForo.XenGalleryCommentInlineEdit.prototype={__construct:function(t){this.container=t;this.$trigger=t.click(e.context(this,"show"))},show:function(t){var n=this.$trigger.closest(".xenOverlay").data("overlay"),r,i;if(n&&n.isOpened()){n.getTrigger().one("onClose",e.context(this,"show"));n.getConf().mask.closeSpeed=0;n.close();return}if(!this.OverlayLoader){i={};i=e.extend(i,this.$trigger.data("overlayoptions"));r=this.$trigger.data("cacheoverlay");if(r!==undefined){if(XenForo.isPositive(r)){r=true}else{r=false;i.onClose=e.context(this,"deCache")}}else{r=false;i.onClose=e.context(this,"deCache")}this.OverlayLoader=new XenForo.OverlayLoader(this.$trigger,r,i);this.OverlayLoader.load();t.preventDefault();return true}this.OverlayLoader.show()},deCache:function(){if(this.OverlayLoader&&this.OverlayLoader.overlay){console.info("DeCache %o",this.OverlayLoader.overlay.getOverlay());this.OverlayLoader.overlay.getTrigger().removeData("overlay");this.OverlayLoader.overlay.getOverlay().empty().remove()}delete this.OverlayLoader}};XenForo.XenGalleryInlineCommentEditor=function(e){new XenForo.AutoValidator(e);e.bind({AutoValidationComplete:function(t){var n=e.closest("div.xenOverlay").data("overlay"),r=n.getTrigger();if(XenForo.hasTemplateHtml(t.ajaxData,"messagesTemplateHtml")||XenForo.hasTemplateHtml(t.ajaxData)){t.preventDefault();r.closest(".commentInfo").find(".commentContent article blockquote").html(t.ajaxData._message);n.close()}}})};XenForo.XenGalleryInlineCommentDelete=function(t){t.bind({AutoValidationComplete:function(n){var r=t.closest("div.xenOverlay").data("overlay"),i=r.getTrigger(),s=i.closest("li.comment");if(XenForo.hasTemplateHtml(n.ajaxData,"messagesTemplateHtml")||XenForo.hasTemplateHtml(n.ajaxData)){n.preventDefault();r.close();if(n.ajaxData.hardDelete){s.slideUp().remove();XenForo.alert(n.ajaxData.phrase,"",2e3)}else{e(n.ajaxData.messagesTemplateHtml).xfInsert("replaceAll",s,"xfFadeIn",XenForo.speed.fast)}}}})};XenForo.XenGalleryOverlayPhotoTagging=function(e){e.photoTag({requestTagsUrl:e.data("tagrequesturl"),deleteTagsUrl:e.data("tagdeleteurl"),addTagUrl:e.data("tagaddurl"),parametersForRequest:["_xfNoRedirect"],imageWrapper:e.data("imagewrapper"),externalAddTagLinks:{bind:true},parametersForNewTag:{username:{label:"",_xfToken:XenForo._csrfToken}},literals:{saveTag:e.data("savephrase"),cancelTag:e.data("cancelphrase")}})};XenForo.XenGalleryRelatedPhotos=function(e){this.__construct(e)};XenForo.XenGalleryRelatedPhotos.prototype={__construct:function(e){this.$container=e;e.scrollable({mousewheel:false,keyboard:false})}};XenForo.register("img.photo","XenForo.XenGalleryOverlayPhotoTagging");XenForo.register(".toolAlbum .likeAlbum .control.like","XenForo.XenGalleryLikeAlbum");XenForo.register(".item.quickEdit","XenForo.XenGalleryQuickEdit");XenForo.register(".photoWrapper","XenForo.XenGalleryPhotoWrapper");XenForo.register("a.WatchLink","XenForo.WatchLink");XenForo.register(".shareList .share-action","XenForo.XenGalleryPhotoShare");XenForo.register(".masonryContainer","XenForo.XenGalleryContainer");XenForo.register(".streamingEditor","XenForo.XenGalleryStreamEditor");XenForo.register(".streamingHeader .editToggle, .streaming .editToggle","XenForo.XenGalleryStreamEditorToggle");XenForo.register(".cloudForm .xenForm","XenForo.XenGalleryStreamJump");XenForo.register("a.XenGalleryCommentLoader","XenForo.XenGalleryCommentLoader");XenForo.register("a.XenGalleryCommentPoster","XenForo.XenGalleryCommentPoster");XenForo.register("a.item.edit:not(.NoOverlay), a.item.delete:not(.NoOverlay)","XenForo.XenGalleryCommentInlineEdit");XenForo.register("form.XenGalleryInlineCommentEditor","XenForo.XenGalleryInlineCommentEditor");XenForo.register("form.XenGalleryInlineCommentDelete","XenForo.XenGalleryInlineCommentDelete");XenForo.register(".scrollable","XenForo.XenGalleryRelatedPhotos");XenForo.register(".img img.lazy","XenForo.XenGalleryListLazyLoad")}(jQuery,this,document)