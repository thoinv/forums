
/**
 * @category    XenForo
 * @package     sonnb - XenGallery
 * @version     2.1.3
 * @copyright:  sonnb
 * @link        www.sonnb.com
 * @version     One license is valid for only one nominated domain.
 * @license     You might not copy or redistribute this addon. Any action to public or redistribute must be authorized from author
 */
!function(e,t,n,r){XenForo.XenGalleryOverlayToggle=function(e){this.__construct(e)};XenForo.XenGalleryOverlayToggle.prototype={__construct:function(n){this.$toggle=n;this.$trigger=n.click(e.context(this,"show"));this.$wrapper=null;if(typeof t.galleryOverlayXhr==="undefined"){t.galleryOverlayXhr=false}if(!e("body > .galleryOverlay").length){t.currentUrl=t.location.href}},show:function(n){if(t.galleryOverlayXhr){return false}var r=this.$toggle.attr("href");t.galleryOverlayXhr=XenForo.ajax(r,{},e.context(this,"onDataReceived"),{type:"GET"});return false},onDataReceived:function(n,r){if(!n){return false}if(XenForo.hasResponseError(n)){return false}if(n.templateHtml){new XenForo.ExtLoader(n,e.context(this,"createOverlay"));var i=this.$toggle.attr("href");if(t.history.pushState){t.history.pushState({target:i},this.$toggle.attr("title"),i)}}else{console.warn("No valid ajax data returned.")}return false},createOverlay:function(n){this.$wrapper=e('<div class="galleryOverlay __XenForoActivator" />');this.$wrapper.css({position:"fixed",top:"0",left:"0",right:"0",bottom:"0","background-color":"rgba(0, 0, 0, 0.75)","z-index":"400"});e("div.galleryOverlay").each(function(t){var n=e(this);e(".shareContainerOverlay").closest(".shareOverlay").empty().remove();n.find("object").remove();n.fadeOut("slow",function(){n.empty().remove()})});var r=e(n.templateHtml),i=t.innerHeight,s=t.innerWidth,o=e(".goMediaHolder",r),u=this.$wrapper,a=e(".goMediaContainer",r),f=e(".goCommentWrapper",r),l=e("img.photo",r).length?e("img.photo",r):e(".goMediaContainer .videoHolder",r),c=l.data("height"),h=l.data("width"),p,d;if(o.hasClass("hasRelated")&&s>370&&i>370){p=i-110}else{if(s>370&&i>370){p=i-40}else{p=i}}d=p/l.data("height")*l.data("width");o.css({height:p+"px","line-height":p+"px"});if(e.getCookie("xengallery_comment_sidebar")==null){e.setCookie("xengallery_comment_sidebar",1)}if(o.hasClass("video")){if(a.find("iframe").length){a.find("iframe").attr("height",p-34)}else{a.find("object").attr("height",p-34);a.find("embed").attr("height",p-34)}}else{a.css({height:(p>c?c:p)+"px","line-height":(p>c?c:p)+"px",width:(d>h?h:d)+"px",top:(p>c?(p-c)/2:"0")+"px"})}if(!parseInt(e.getCookie("xengallery_comment_sidebar"))||s<710){var v=e(".goMedia",r),m=e(r[2]),g=e(r[0]),y=e(".pwPhotoActions .action.comment",r);f.hide();y.removeClass("active");v.addClass("noSidebar");m.addClass("noSidebar");g.addClass("noSidebar")}else{f.show();e(".pwPhotoActions .action.comment",r).addClass("active")}u.append(r).appendTo("body").xfActivate();e("body").addClass("noscroll");e(".OverlayCloser",this.$wrapper).click(e.context(this,"closeOverlay"));e(t).keyup(e.context(this,"keyPress"));e(t).bind("orientationchange resize",e.context(this,"onResize"));var b=e(".photo.lazy",this.$wrapper);b.bind("load",function(){b.removeClass("lazy").addClass("loaded").data("src","").parent().addClass("loaded")}).bind("error",function(){b.parent().addClass("broken");a.css({top:(p-32)/2+"px"})}).attr("src",b.data("src"));b.mousedown(function(){return false}).click(e.context(this,"clickOnPhoto"));e(".pwPhotoActions .action.like",this.$wrapper).click(e.context(this,"actionLike"));e(".pwPhotoActions .action.share",this.$wrapper).click(e.context(this,"actionShare"));e(".pwPhotoActions .action.comment",this.$wrapper).click(e.context(this,"actionCommentToggle"));e(".goActions .action.share",this.$wrapper).click(e.context(this,"actionShare"));if(XenForo.isRTL()){e(".goMediaHolder",this.$wrapper).bind("swipeleft",e.context(this,"actionSwipePrev"));e(".goMediaHolder",this.$wrapper).bind("swiperight",e.context(this,"actionSwipeNext"));b.bind("swipeleft",e.context(this,"actionSwipePrev"));b.bind("swiperight",e.context(this,"actionSwipeNext"))}else{e(".goMediaHolder",this.$wrapper).bind("swiperight",e.context(this,"actionSwipePrev"));e(".goMediaHolder",this.$wrapper).bind("swipeleft",e.context(this,"actionSwipeNext"));b.bind("swiperight",e.context(this,"actionSwipePrev"));b.bind("swipeleft",e.context(this,"actionSwipeNext"))}e(".goCommentWrapper",this.$wrapper).bind("swiperight",e.context(this,"actionSwipeRight"));if(t.galleryOverlayXhr){t.galleryOverlayXhr=false}return false},onResize:function(n){this.$wrapper.css({top:"0",left:"0",right:"0",bottom:"0"});var r=t.innerHeight,i=t.innerWidth,s=e(".goMediaHolder",this.$wrapper),o=e(".goMediaContainer",this.$wrapper),u=e(".goCommentWrapper",this.$wrapper),a=e("img.photo",this.$wrapper).length?e("img.photo",this.$wrapper):e(".goMediaContainer .videoHolder",this.$wrapper),f=a.data("height"),l=a.data("width"),c,h;if(s.hasClass("hasRelated")&&i>370&&r>370){c=r-110}else{if(i>370&&r>370){c=r-40}else{c=r}}h=c/a.data("height")*a.data("width");s.css({height:c+"px","line-height":c+"px"});if(s.hasClass("video")){if(o.find("iframe").length){o.find("iframe").attr("height",c-34)}else{o.find("object").attr("height",c-34);o.find("embed").attr("height",c-34)}}else{o.css({height:(c>f?f:c)+"px","line-height":(c>f?f:c)+"px",width:(h>l?l:h)+"px",top:(c>f?(c-f)/2:"0")+"px"});if(o.hasClass("broken")){o.css({top:(c-32)/2+"px"})}}},clickOnPhoto:function(t){var n=!e("html").hasClass("desktop"),r=e(".goMediaHolder",this.$wrapper),i=e(".caption",r),s=e(".goActions .title",this.$wrapper),o=e(".OverlayCloser",this.$wrapper),u=e(".originalLink",this.$wrapper);if(i.is(":visible")){i.fadeOut();if(n){o.hide();u.hide()}}else{i.fadeIn();o.show();u.show()}},keyPress:function(t){var n=t.keyCode||t.charCode;if(n==27&&e("div.galleryOverlay").is(":visible")){this.closeOverlay(t)}if(!e(".photoTag-cpanel",this.$wrapper).is(":visible")&&!e("body > div.xenOverlay").is(":visible")){switch(n){case 37:t.preventDefault();e(".prevPhoto.hasPhoto",this.$wrapper).trigger("click");return false;break;case 39:t.preventDefault();e(".nextPhoto.hasPhoto",this.$wrapper).trigger("click");return false;break;default:return true}}},closeOverlay:function(n){var r=this.$wrapper;e("body").removeClass("noscroll");e(".shareContainerOverlay").closest(".shareOverlay").empty().remove();r.find("object").remove();r.fadeOut("slow",function(){r.empty().remove()});if(t.currentUrl&&t.history.pushState){t.history.pushState({target:t.currentUrl},null,t.currentUrl)}},actionSwipePrev:function(t){console.log("actionSwipePrev");e(".prevPhoto.hasPhoto",this.$wrapper).trigger("click");return false},actionSwipeNext:function(t){e(".nextPhoto.hasPhoto",this.$wrapper).trigger("click");return false},actionSwipeRight:function(t){var n=this,r=e(".pwPhotoActions .action.comment",this.$wrapper),i=e(".goCommentWrapper",this.$wrapper),s=e(".goMedia",this.$wrapper),o=e(".OverlayCloser",this.$wrapper),u=e(".originalLink",this.$wrapper);if(r.hasClass("active")||i.is(":visible")){i.fadeOut("fast",function(){r.removeClass("active");e.setCookie("xengallery_comment_sidebar",0);s.addClass("noSidebar");o.addClass("noSidebar");u.addClass("noSidebar");n.onResize(t)})}return false},actionCommentToggle:function(t){t.preventDefault();var n=this,r=e(t.target),i=e(".goCommentWrapper",this.$wrapper),s=e(".goMedia",this.$wrapper),o=e(".OverlayCloser",this.$wrapper),u=e(".originalLink",this.$wrapper);if(r.is("i")){r=r.parent()}if(r.hasClass("active")){i.fadeOut("fast",function(){e.setCookie("xengallery_comment_sidebar",0);r.removeClass("active");s.addClass("noSidebar");o.addClass("noSidebar");u.addClass("noSidebar");n.onResize(t)})}else{e.setCookie("xengallery_comment_sidebar",1);r.addClass("active");s.removeClass("noSidebar");o.removeClass("noSidebar");u.removeClass("noSidebar");i.show();n.onResize(t)}return false},actionLike:function(t){t.preventDefault();var n=e(".pwPhotoActions .action.like",this.$wrapper);var r=e("a.LikeLink",this.$wrapper);XenForo.ajax(n.attr("href"),{},function(t,i){if(XenForo.hasResponseError(t)){return false}n.stop(true,true);if(t.term){r.find(".LikeLabel").html(t.term);if(t.cssClasses){e.each(t.cssClasses,function(e,t){if(t=="+"&&e=="like"){n.removeClass("active");return}if(t=="+"&&e=="unlike"){n.addClass("active");return}r[t=="+"?"addClass":"removeClass"](e)})}}if(t.templateHtml==""){e(r.data("container")).xfFadeUp(XenForo.speed.fast,function(){e(this).empty().xfFadeDown(0)})}else{var s=e(r.data("container")),o=s.find(".LikeText"),u=e(t.templateHtml);if(o.length){o.xfFadeOut(50,function(){var t=this.parentNode;e(this).remove();u.find(".LikeText").xfInsert("appendTo",t,"xfFadeIn",50)})}else{new XenForo.ExtLoader(t,function(){u.xfInsert("appendTo",s)})}}})},actionShare:function(t){t.preventDefault();var n=e(".goMedia .action.share",this.$wrapper),r={fixed:false,className:"shareOverlay",onBeforeLoad:function(){n.addClass("active")},onClose:function(){n.removeClass("active")}};r=e.extend(r,n.data("overlayoptions"));XenForo.createOverlay(null,e(".shareContainerOverlay"),r).load()}};XenForo.XenGalleryPopupMenu=function(e){this.__construct(e)};XenForo.XenGalleryPopupMenu.prototype={__construct:function(e){e.find("ul.Menu1").addClass("Menu");var t=new XenForo.PopupMenu(e);t.triggersMenuHide=function(e){return true};this.$container=e}};XenForo.register(".img a.hasOverlay, .action.fullscreen, .goMedia .scrollable .items > a, .goMedia .prevPhoto.hasPhoto, .goMedia .nextPhoto.hasPhoto","XenForo.XenGalleryOverlayToggle");XenForo.register(".goWrapper .goPopup","XenForo.XenGalleryPopupMenu")}(jQuery,this,document)