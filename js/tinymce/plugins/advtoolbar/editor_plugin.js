(function(){var r=!1,n=1,t=1,c,s,o,h,u,f,e,l=1,i=[];tinymce.create("tinymce.plugins.AdvBBcodesToolbar",{init:function(l,a){function y(n){var t=l.getParam("theme_xenforo_dialog_url");return t.indexOf("?")==-1?t+"?dialog="+encodeURIComponent(n):t+"&dialog="+encodeURIComponent(n)}var v=this;l.addCommand("AdvPicasa",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_picasa_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_picasa"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advpicasa"),width:510,height:289,inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_picasa",{title:"advtoolbar.picasa_desc",cmd:"AdvPicasa"}),l.addCommand("AdvArticle",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_article_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_article"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advarticle"),width:"510",height:"289",inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_article",{title:"advtoolbar.article_desc",cmd:"AdvArticle"}),l.addCommand("AdvEncadre",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_enc_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_enc"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advenc"),width:"510",height:"289",inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_encadre",{title:"advtoolbar.encadre_desc",cmd:"AdvEncadre"}),l.addCommand("AdvFieldset",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_fieldset_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_fieldset"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advfieldset"),width:"510",height:"289",inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_fieldset",{title:"advtoolbar.fieldset_desc",cmd:"AdvFieldset"}),l.addCommand("AdvGview",function(){l.focus(),l.selection.setContent("[gview]"+l.selection.getContent()+"[/gview]")}),l.addButton("adv_gview",{title:"advtoolbar.gview_desc",cmd:"AdvGview"}),l.addCommand("AdvBimg",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_bimg_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_bimg"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advbimg"),width:"510",height:"289",inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_bimg",{title:"advtoolbar.bimg_desc",cmd:"AdvBimg"}),l.addCommand("AdvJustif",function(){l.focus(),l.selection.setContent("[justif]"+l.selection.getContent()+"[/justif]")}),l.addButton("adv_justif",{title:"advtoolbar.justif_desc",cmd:"AdvJustif"}),l.addCommand("AdvLatex",function(){l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_latex_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_latex"},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advlatex"),width:"510",height:"289",inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_latex",{title:"advtoolbar.latex_desc",cmd:"AdvLatex"}),l.addCommand("AdvSpoiler",function(){l.focus(),l.selection.setContent("[spoiler]"+l.selection.getContent()+"[/spoiler]")}),l.addButton("adv_spoiler",{title:"advtoolbar.spoiler_desc",cmd:"AdvSpoiler"}),l.addCommand("AdvSpoilerBB",function(){l.focus(),l.selection.setContent("[spoilerbb]"+l.selection.getContent()+"[/spoilerbb]")}),l.addButton("adv_spoilerbb",{title:"advtoolbar.spoiler_desc",cmd:"AdvSpoilerBB"}),l.addCommand("AdvPrivate",function(){var n=l.getParam("advtoolbar_AdvPV");l.focus(),l.selection.setContent("["+n+"]"+l.selection.getContent()+"[/"+n+"]")}),l.addButton("adv_private",{title:"advtoolbar.private_desc",cmd:"AdvPrivate"}),l.addCommand("AdvPrivate2",function(){var n=l.getParam("advtoolbar_AdvPV2");l.focus(),l.selection.setContent("["+n+"]"+l.selection.getContent()+"[/"+n+"]")}),l.addButton("adv_private2",{title:"advtoolbar.private2_desc",cmd:"AdvPrivate2"}),l.addCommand("AdvPremium",function(){var n=l.getParam("advtoolbar_AdvPREM");l.focus(),l.selection.setContent("["+n+"]"+l.selection.getContent()+"[/"+n+"]")}),l.addButton("adv_premium",{title:"advtoolbar.premium_desc",cmd:"AdvPremium"}),l.addCommand("AdvPremium2",function(){var n=l.getParam("advtoolbar_AdvPREM2");l.focus(),l.selection.setContent("["+n+"]"+l.selection.getContent()+"[/"+n+"]")}),l.addButton("adv_premium2",{title:"advtoolbar.premium2_desc",cmd:"AdvPremium2"}),l.addCommand("AdvAccordion",function(){var n;n=$.browser.msie&&$.browser.version=="6.0"?"ie6":"",l.getParam("fast_overlay")==1?(XenForo.tinymce._overlay_callbacks(v,"adv_accordion_ontrigger"),XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_adv_accordion"+n},XenForo.tinymce._overlay_success)):(l.focus(),l.windowManager.open({file:y("advaccordion"+n),width:510,height:289,inline:!0},{plugin_url:a,some_custom_arg:"custom arg"}))}),l.addButton("adv_accordion",{title:"advtoolbar.accordion_desc",cmd:"AdvAccordion"}),l.addCommand("AdvHighlight",function(){c=l.getParam("advtoolbar_Hl_Norm_Open"),s=l.getParam("advtoolbar_Hl_Norm_Options"),o=l.getParam("advtoolbar_Hl_Norm_Close"),h=l.getParam("advtoolbar_Hl_Spe_Open"),u=l.getParam("advtoolbar_Hl_Spe_Content"),f=l.getParam("advtoolbar_Hl_Spe_Close"),e=l.getParam("advtoolbar_Hl_Tag_Separator"),i.normalOpen=/(\[[^\/]+?)((?==)[^\[]*?)?\](?!<[\/]?span)/gi,i.normalClose=/(\[\/([^[]+?)\])(?!<\/span>)/gi,i.special=/(\{([^\/]+?)(?:=.+?)?\})(?!<\/span>)((?:\{\2(?:=.+?)?\}(?:\{\2(?:=.+?)?\}[\s\S]*?\{\/\2\}|[\s\S])+?\{\/\2\}|[\s\S])*?)(\{\/\2\})/gi,r===!1?(l.onNodeChange.add(function(n,t){t.setActive("adv_highlight",1),r=!0}),l.onNodeChange.add(v._getHighlight),l.onKeyDown.add(v._getHighlight)):(l.onNodeChange.add(function(n,t){t.setActive("adv_highlight",0),r=!1}),l.onNodeChange.remove(v._getHighlight),l.onKeyDown.remove(v._getHighlight),l.dom.remove(l.dom.select(".adv_hl"),"adv_hl"),n=0,t=0)}),l.onInit.add(function(i){i.dom.remove(i.dom.select(".adv_hl"),"adv_hl"),n=0,t=0}),l.addButton("adv_highlight",{title:"advtoolbar.highlight_desc",cmd:"AdvHighlight"})},_getHighlight:function(r){var v=r.getContent(),y=!1,p=!1,k=!1,b=!1,w;i.normalOpen.test(v)&&(y=!0,p=!0,v=v.replace(i.normalOpen,function(t,i,r){var u,f;return n++,u='<span id="advhln_'+n+'" class="adv_hl adv_hln_'+n+'" style="background-color:'+c+'">'+i,typeof r!="undefined"&&(f=i=="[picasa"?/,/gi:/\|/gi,r=r.replace(f,'<span class="adv_hl" style="color:'+e+';font-weight:bolder;">$&</span>'),u+='<span class="adv_hl adv_hln_'+n+" tag_options_"+n+'" style="background-color:'+s+'">'+r+"</span>"),u+="]</span>"})),i.normalClose.test(v)&&(y=!0,p=!0,v=v.replace(i.normalClose,function(t,i){return n++,'<span id="advhln_'+n+'" class="adv_hl adv_hln_'+n+'" style="background-color:'+o+'">'+i+"</span>"})),i.special.test(v)&&(y=!0,k=!0,v=v.replace(i.special,function(n,i,r,e,o){return t++,e||(b=!0),'<span id="advhls_open_'+t+'" class="adv_hl adv_hls_'+t+'" style="background-color:'+h+'">'+i+'</span><span id="advhls_content_'+t+'" class="adv_hl  adv_hls_'+t+'" style="background-color:'+u+'">'+e+'</span><span id="advhls_close_'+t+'" class="adv_hl  adv_hls_'+t+'" style="background-color:'+f+'">'+o+"</span>"})),y&&(r.setContent(v),p===!0?(r.selection.select(r.dom.select("span#advhln_"+n)[0]),r.selection.setContent(r.selection.getContent())):k===!0&&(b?(r.selection.select(r.dom.select("span#advhls_open_"+t)[0]),w=r.selection.getContent()+'<span id="advhls_content_'+n+'" class="adv_hl  adv_hls_'+n+'" style="background-color:'+u+'"><span id="adv_caretfix"></span></span>',r.selection.setContent(w),r.selection.select(r.dom.select("span#adv_caretfix")[0]),r.selection.setContent(r.selection.getContent())):(r.selection.select(r.dom.select("span#advhls_close_"+t)[0]),r.selection.setContent(r.selection.getContent()))))},adv_picasa_ontrigger:function(n){AdvPicasaDialog.submit(n)},adv_latex_ontrigger:function(n){AdvLatexDialog.submit(n)},adv_fieldset_ontrigger:function(n){AdvFieldsetDialog.submit(n)},adv_enc_ontrigger:function(n){AdvEncDialog.submit(n)},adv_bimg_ontrigger:function(n){AdvBimgDialog.submit(n)},adv_accordion_ontrigger:function(n){AdvAccordionDialog.submit(n)},adv_article_ontrigger:function(n){AdvArticleDialog.submit(n)},getInfo:function(){return{longname:"Advanced BBcodes Bar",author:"Cédric Claerhout",authorurl:"http://xenforo.com/community/members/cclaerhout.509/",infourl:"",version:"3.2"}}}),tinymce.PluginManager.add("advtoolbar",tinymce.plugins.AdvBBcodesToolbar)})();