!function(c,b,a,d){XenForo.Adv_Template_Accordion={AjaxResponse:false,mode:"accordion",phrase_fulldisplay:"",heightcmd_width_original:"",init:function(e){var f=XenForo.Adv_Template_Accordion,g;f.isMiu=false;$height=c("#ctrl_height");f.phrase_fulldisplay=$height.val();f.heightcmd_width_original=$height.css("width");if(!e.hasClass("isMiu")){if(typeof tinyMCEPopup!=="undefined"){f.ed=tinyMCEPopup.editor}else{f.ed=XenForo.tinymce.ed}g=f.ed.selection.getContent()}else{f.isMiu=true;g=XenForo.MiuFramework.miu.selection}if(g.length!=0){if(f.AjaxResponse===false){f.globalElement=e;XenForo.ajax("index.php?editor/to-bb-code",{html:g},f.html2bbcode);return false}e.find("#slide_content_1").val(f.AjaxResponse).animate({height:"75px"},"fast")}f.bakeBasics(e);e.find("#createSlide").click(function(j){var h=c("#slides").children().length+1,i=e.find("#model").html().replace(/replaceid/g,h);c(i).appendTo("#slides");f.bakeBasics(e);c("#slide_content_"+h).focus()});e.find("#ctrl_mode").change(function(){f.mode=c(this).val();f.bakeBasics(e)})},bakeBasics:function(e){var h=XenForo.Adv_Template_Accordion;if(h.isMiu==false){var j=h.ed.getParam("advtoolbar_template_strechedtitlewidth"),f=h.ed.getParam("advtoolbar_template_normaltitlewidth"),k=h.ed.getParam("advtoolbar_template_phrase_auto")}else{var j=e.attr("data-streched-width"),f=e.attr("data-normal-width"),k=e.attr("data-auto")}$height=c("#ctrl_height");var g=(h.mode=="accordion")?h.heightcmd_width_original:"35px";heightPhrase=(h.mode=="accordion")?h.phrase_fulldisplay:k;$height.css("width",g);$height.val(heightPhrase);$ctrl_width=e.find("#ctrl_width");$widthtype=e.find("#ctrl_widthtype").hide();$cmd_height=e.find(".CMD_Height");$heightpx=e.find(".heightpx").hide();$masterHeight=e.find("#MasterHeight");$slaveHeight=c("#slides").find(".CMD_Height");$openBox=c("#slides").find(".CMD_Open").find("input");$openBoxChk=c("#slides").find(".CMD_Open").find("input:checked");if(h.mode=="accordion"){$masterHeight.css("visibility","hidden");$slaveHeight.show()}else{$masterHeight.css("visibility","visible");$slaveHeight.hide()}if(!isNaN(c("#ctrl_width").val())){$masterHeight.css("visibility","visible");$widthtype.show()}$ctrl_width.one("focus",function(){c(this).val("")}).unbind("focus focusout").bind("focus",function(){$widthtype.show("fast");if(c(this).val()==k){c(this).val("")}}).bind("focusout",function(){var l=c(this).val();var m=new RegExp("[０-９]+");if(m.test(l)){l=h.zen2han(l);c(this).val(l)}if(c(this).val().length==0||isNaN(c(this).val())){$widthtype.hide("fast");c(this).val(k);if(h.mode=="accordion"){$masterHeight.css("visibility","hidden").children("input").val(heightPhrase).css("width",g)}}else{$masterHeight.css("visibility","visible")}});$widthtype.unbind("click").bind("click",function(l){if(c(this).val()=="%"){c(this).val("px")}else{c(this).val("%")}});if(!isNaN(c("#MasterHeight input").val())){$slaveHeight.hide()}c(".CMD_Height").children("input").one("focus",function(){c(this).val("")}).unbind("focus focusout").bind("focus",function(){c(this).next(".heightpx").show("fast");if(c(this).val()==heightPhrase){c(this).val("")}c(this).animate({width:"30px"},function(){})}).bind("focusout",function(){var l=c(this).val();var m=new RegExp("[０-９]+");if(m.test(l)){l=h.zen2han(l);c(this).val(l)}if(c(this).val().length==0||isNaN(c(this).val())){c(this).animate({width:g},function(){c(this).val(heightPhrase)});if(c(this).parent().attr("id")=="MasterHeight"&&h.mode=="accordion"){$slaveHeight.show("slow")}}else{if(c(this).parent().attr("id")=="MasterHeight"&&h.mode=="accordion"){$slaveHeight.hide("slow");$slaveHeight.children("input").val(heightPhrase).css("width",g)}}c(this).next(".heightpx").hide()});e.find(".CMD_Title").children("input").one("focus",function(){data_ctrl_title_width=c(this).css("width");c(this).val("")}).unbind("focus focusout").bind("focus",function(){c(this).parent().nextAll("li").hide();c(this).animate({width:"300px"},"fast")}).bind("focusout",function(){$fout=c(this);c(this).animate({width:f},function(){if(isNaN(c("#MasterHeight input").val())&&h.mode=="accordion"){$fout.parent().nextAll("li").show()}else{$fout.parent().nextAll("li:not(.CMD_Height)").show()}})});$cmdAlign=e.find(".CMD_Align li");$allAlign=$cmdAlign.parent().children("li").children("div");function i(l){l.removeClass("align_select_left align_select_center align_select_right")}if(h.mode=="tabs"){i($allAlign);$cmdAlign.find(".align_center").addClass("align_select_center")}$cmdAlign.unbind("click").bind("click",function(l){$align_target_button=c(this).children("div");$align_target_form=c(this).parent().next("input");i(c(this).parent().children("li").children("div"));if($align_target_button.hasClass("align_left")){$align_target_button.addClass("align_select_left");$align_target_form.val("left")}else{if($align_target_button.hasClass("align_center")){$align_target_button.addClass("align_select_center");$align_target_form.val("center")}else{if($align_target_button.hasClass("align_right")){$align_target_button.addClass("align_select_right");$align_target_form.val("right")}}}});e.find(".slide_content").children("textarea").focus(function(){c(this).animate({height:"75px"},"fast")}).focusout(function(){c(this).animate({height:"15px"},"fast")});e.find(".deleteSlide").unbind("click").bind("click",function(l){c(this).parent().parent().remove();h.updateID()});$openBox.unbind("change");if(h.mode!="accordion"){if($openBoxChk.length>1){$openBox.removeAttr("checked");$openBox.first().attr("checked","checked")}else{if($openBoxChk.length==0){$openBox.first().attr("checked","checked")}}$openBox.bind("change",function(l){$openBox.removeAttr("checked");c(this).attr("checked","checked")})}},updateID:function(){var e=1;c(".slide").not(c("#model .slide")).each(function(f){c(this).attr("id","slide_"+e);c(this).find(".CMD_Title input").attr("id","slide_title_"+e).attr("name","slidetitle"+e);c(this).find(".CMD_Align input").attr("id","slide_align_"+e).attr("name","slidealign"+e);c(this).find(".CMD_Height input").attr("id","slide_height_"+e).attr("name","slideheight"+e);c(this).find(".CMD_Open input").attr("id","slide_open_"+e).attr("name","slideopen"+e);c(this).find(".CMD_Content textarea").attr("id","slide_content_"+e).attr("name","slidecontent"+e);c(this).find(".CMD_Id").text(e);e++})},zen2han:function(i){var e,g="",f,h;for(f=0,h=i.length;f<h;f++){e=i.charCodeAt(f);e=((e>=65281&&e<=65392)?e-65248:e);e=(e===12540?45:e);g=g+String.fromCharCode(e)}return g},unescapeHtml:function(g,f){g=g.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");if(f=="space"){g=g.replace(/    /g,"\t").replace(/&nbsp;/g,"  ").replace(/<\/p>\n<p>/g,"\n")}var e=new RegExp("^<p>([\\s\\S]+)</p>$","i");if(e.test(g)){g=g.match(e);g=g[1]}return g},html2bbcode:function(e){if(XenForo.hasResponseError(e)){return}var f=XenForo.Adv_Template_Accordion;f.AjaxResponse=e.bbCode;f.init(f.globalElement);return false}};XenForo.register("#adv_accordion","XenForo.Adv_Template_Accordion.init")}(jQuery,this,document);