!function(n){XenForo.Adv_Template_Bimg={AjaxResponse:!1,init:function(t){var o=XenForo.Adv_Template_Bimg,u,i,r,f,e;t.hasClass("isMiu")?(f=t.attr("data-auto"),e=t.attr("data-bimgid"),i=XenForo.MiuFramework.miu.selection):(u=typeof tinyMCEPopup!="undefined"?tinyMCEPopup.editor:XenForo.tinymce.ed,f=u.getParam("advtoolbar_template_phrase_auto"),i=u.selection.getContent(),e=u.getLang("advtoolbar.bimg_id")),r=i.match(/(?:alt="attach(?:Thumb|Full)(\d+?)"|\[ATTACH(?:=.+?)?\](\d+?)\[\/ATTACH\])/i),r&&(r[1]&&(i=r[1]),r[2]&&(i=r[2]),t.find("#url_phrase").text(e)),i.length!=0&&t.find("#ctrl_src").val(o.unescapeHtml(i,"space").replace(/\<[^\>]*\>/gi,"")),$info=t.find(".info").hide(),t.find("#float_select li").click(function(){if($target=t.find("#ctrl_float"),$active=t.find("#float_select li.active"),n(this).hasClass("active"))n(this).hasClass("active")&&n(this).attr("id")=="normalSelect"&&(n(this).hasClass("normal")?(n(this).removeClass("normal").addClass("normal_center"),$target.val("normal_center"),n(this).children("span#normalText").addClass("hidden"),n(this).children("span#centerText").removeClass("hidden")):n(this).hasClass("normal_center")?(n(this).removeClass("normal_center").addClass("normal_right"),$target.val("normal_right"),n(this).children("span#centerText").addClass("hidden"),n(this).children("span#rightText").removeClass("hidden")):(n(this).removeClass("normal_right").addClass("normal"),$target.val("normal"),n(this).children("span#rightText").addClass("hidden"),n(this).children("span#normalText").removeClass("hidden")));else{var r=n(this).attr("class");$active.removeClass("active"),n(this).addClass("active"),$target.val(r),n(this).hasClass("normal")?$info.slideUp():$info.slideDown()}}),t.find("#caption_content").hide(),t.find("#trigger_caption").click(function(){$target=n(this).next(),n(this).hasClass("active")?(n(this).removeClass("active"),$target.slideUp(),n("#ctrl_src").focus()):(n(this).addClass("active"),$target.slideDown(),n("#ctrl_caption").focus())}),t.find("#caption_select li").click(function(){if($target=t.find("#ctrl_caption_position"),$active=t.find("#caption_select li.active"),!n(this).hasClass("active")){var r=n(this).attr("class");$active.removeClass("active"),n(this).addClass("active"),$target.val(r)}}),$widthtype=t.find("#ctrl_widthtype").hide(),t.find("#ctrl_width").one("focus",function(){n(this).val("")}).focus(function(){$widthtype.show("fast"),n(this).val()==f&&n(this).val("")}).focusout(function(){var t=n(this).val(),i=new RegExp("[０-９]+");i.test(t)&&(t=o.zen2han(t),n(this).val(t)),(n(this).val().length==0||isNaN(n(this).val()))&&(n(this).val(f),$widthtype.hide("fast"))}),$widthtype.click(function(){n(this).val()=="%"?n(this).val("px"):n(this).val("%")})},zen2han:function(n){for(var t,r="",i=0,u=n.length;i<u;i++)t=n.charCodeAt(i),t=t>=65281&&t<=65392?t-65248:t,t=t===12540?45:t,r=r+String.fromCharCode(t);return r},unescapeHtml:function(n,t){n=n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),t=="space"&&(n=n.replace(/    /g,"\t").replace(/&nbsp;/g,"  ").replace(/<\/p>\n<p>/g,"\n"));var i=new RegExp("^<p>([\\s\\S]+)</p>$","i");return i.test(n)&&(n=n.match(i),n=n[1]),n},html2bbcode:function(n){if(!XenForo.hasResponseError(n)){var t=XenForo.Adv_Template_Bimg;return t.AjaxResponse=n.bbCode,t.init(t.globalElement),!1}}},XenForo.register("#adv_bimg","XenForo.Adv_Template_Bimg.init")}(jQuery,this,document);